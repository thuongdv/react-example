global
    log stdout local0
    maxconn 1024
    daemon

resolvers aws_resolver
    nameserver dns1 169.254.169.253:53
    resolve_retries 3
    timeout resolve 1s
    timeout retry 1s
    hold valid 60s

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5000
    timeout client  50000
    timeout server  50000

frontend frontend
    bind *:8080
    
    # Add stats endpoint for health checks
    stats enable
    stats uri /haproxy-stats
    stats refresh 30s
    
    # Route stats requests to stats, everything else to backend
    use_backend stats if { path_beg /haproxy-stats }
    default_backend backend_nginx

backend stats
    stats enable

backend backend_nginx
    balance roundrobin
    server nginx nginx.react-app.local:80 check resolvers aws_resolver init-addr libc,none
